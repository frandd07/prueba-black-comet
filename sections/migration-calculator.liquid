{% comment %}
  MIGRATION CALCULATOR SECTION
  ------------------------------------------------------------------------------
  SecciÃ³n personalizada para calcular costes de migraciÃ³n.
  Incluye sliders interactivos y envÃ­o mediante formulario nativo de Shopify.
  + EXTRAS: GeolocalizaciÃ³n, conversiÃ³n de moneda, y incremento por paÃ­s
{% endcomment %}

{% # Importacion de assets %}
{{ 'migration-calculator.css' | asset_url | stylesheet_tag }}

<style>
  .section-migration-calculator {
    --calc-bg-color: {{ section.settings.background_color | default: '#0b0b0b' }};
    --calc-text-color: {{ section.settings.text_color | default: '#ffffff' }};
    --calc-accent-color: {{ section.settings.accent_color | default: '#00ff88' }};
    --calc-button-bg: {{ section.settings.button_bg_color | default: '#ffffff' }};
    --calc-button-text: {{ section.settings.button_text_color | default: '#000000' }};
    --calc-button-hover: {{ section.settings.button_hover_color | default: '#00ff88' }};
    --calc-form-bg: {{ section.settings.form_bg_color | default: '#121212' }};
    --calc-form-border: {{ section.settings.form_border_color | default: '#333' }};
    --calc-input-bg: {{ section.settings.input_bg_color | default: '#1a1a1a' }};
    --calc-input-border: {{ section.settings.input_border_color | default: '#444' }};
  }
</style>

<div class="page-width section-migration-calculator">
  <div class="calculator-wrapper">
    
    <!-- CABECERA -->
    <div class="calculator-header">
      <h2>{{ section.settings.heading }}</h2>
      <p>{{ section.settings.subheading }}</p>
    </div>

    <div class="calculator-grid">
      <!-- COLUMNA IZQUIERDA: SLIDERS -->
      <div class="sliders-container">
        
        <!-- Slider 1: Clientes -->
        <div class="slider-group">
          <div class="slider-label">
            <label>{{ section.settings.label_customers }}</label>
            <span id="display-customers" class="slider-value">{{ section.settings.default_customers }}</span>
          </div>
          <input 
            type="range" 
            id="range-customers" 
            min="{{ section.settings.min_customers }}" 
            max="{{ section.settings.max_customers }}" 
            step="{{ section.settings.step_customers }}" 
            value="{{ section.settings.default_customers }}" 
            class="calculator-range">
        </div>

        <!-- Slider 2: Pedidos -->
        <div class="slider-group">
          <div class="slider-label">
            <label>{{ section.settings.label_orders }}</label>
            <span id="display-orders" class="slider-value">{{ section.settings.default_orders }}</span>
          </div>
          <input 
            type="range" 
            id="range-orders" 
            min="{{ section.settings.min_orders }}" 
            max="{{ section.settings.max_orders }}" 
            step="{{ section.settings.step_orders }}" 
            value="{{ section.settings.default_orders }}" 
            class="calculator-range">
        </div>

        <!-- Slider 3: Productos -->
        <div class="slider-group">
          <div class="slider-label">
            <label>{{ section.settings.label_products }}</label>
            <span id="display-products" class="slider-value">{{ section.settings.default_products }}</span>
          </div>
          <input 
            type="range" 
            id="range-products" 
            min="{{ section.settings.min_products }}" 
            max="{{ section.settings.max_products }}" 
            step="{{ section.settings.step_products }}" 
            value="{{ section.settings.default_products }}" 
            class="calculator-range">
        </div>


      </div>

      <!-- COLUMNA DERECHA: FORMULARIO -->
      <div class="form-container">
        {% form 'contact' %}
          {% if form.posted_successfully? %}
            <div class="form-success-message">
              <h3>Â¡Solicitud Recibida!</h3>
              <div id="success-price-display"></div>
              <p id="success-message-text">{{ section.settings.success_message_with_price }}</p>
            </div>
          {% else %}
            {{ form.errors | default_errors }}
            
            <div class="form-field">
              <label for="ContactEmail">Email *</label>
              <input type="email" id="ContactEmail" name="contact[email]" placeholder="tu@email.com" required>
            </div>
            
            
            <div class="form-field">
              <label for="ContactPhone">TelÃ©fono *</label>
              <div class="phone-group">
                <select id="ContactCountryCode" name="contact[phone_prefix]" class="country-selector" required>
                  {% for block in section.blocks %}
                    {% if block.type == 'phone_country' %}
                      <option value="{{ block.settings.phone_code }}">{{ block.settings.flag_emoji }} {{ block.settings.phone_code }}</option>
                    {% endif %}
                  {% endfor %}
                </select>
                <input type="tel" id="ContactPhone" name="contact[phone]" placeholder="600 000 000" required>
              </div>
            </div>

            
            <div class="form-field">
              <label for="ContactWebsite">Web Actual *</label>
              <input type="text" id="ContactWebsite" name="contact[website]" placeholder="www.mitienda.com" required>
              <small id="website-error" style="color: #ff4444; display: none;">Por favor, introduce una URL vÃ¡lida (ej: www.mitienda.com)</small>
            </div>
            
            <div class="form-field">
              <label for="ContactCMS">CMS Actual *</label>
              <select id="ContactCMS" name="contact[cms]" required>
                <option value="" disabled selected>Selecciona una plataforma</option>
                <option value="Magento">Magento</option>
                <option value="WooCommerce">WooCommerce</option>
                <option value="Wix">Wix</option>
                <option value="OpenCart">OpenCart</option>
                <option value="PrestaShop">PrestaShop</option>
                <option value="Shopify">Shopify</option>
                <option value="BigCommerce">BigCommerce</option>
                <option value="Squarespace">Squarespace</option>
                <option value="Webflow">Webflow</option>
                <option value="Custom / Headless">Custom / Headless</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- INPUTS OCULTOS -->
            <input type="hidden" name="contact[Customers_Count]" id="hidden-customers">
            <input type="hidden" name="contact[Orders_Count]" id="hidden-orders">
            <input type="hidden" name="contact[Products_Count]" id="hidden-products">
            <input type="hidden" name="contact[Estimated_Price]" id="hidden-price">
            <input type="hidden" name="contact[Is_Custom_Quote]" id="hidden-is-custom" value="false">
            <input type="hidden" name="contact[User_Country]" id="hidden-country">
            <input type="hidden" name="contact[Price_In_Local_Currency]" id="hidden-local-price">

            <div id="calculator-form-error">
              Por favor, completa todos los campos obligatorios.
            </div>

            <button type="submit" id="calculator-submit-btn" class="button button--primary full-width">
              {{ section.settings.button_text }}
            </button>
          {% endif %}
        {% endform %}
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    
    // Price Tiers Configuration
    var pricingTiers = [
      {% for block in section.blocks %}
        {% if block.type == 'price_tier' %}
        {
          limit: {{ block.settings.limit | default: 0 }},
          price: {{ block.settings.price | default: 0 }}
        }{% unless forloop.last %},{% endunless %}
        {% endif %}
      {% endfor %}
    ];
    pricingTiers.sort(function(a, b) { return a.limit - b.limit; });

    // Currency and Country Rates
    var conversionRates = {
      'USD': 1.10,
      'GBP': 0.85,
      'CAD': 1.45,
      'AUD': 1.65,
      'MXN': 22.50,
      'EUR': 1.00
    };

    var currencySymbols = {
      'EUR': 'â‚¬',
      'USD': '$',
      'GBP': 'Â£',
      'CAD': 'CAD $',
      'AUD': 'AUD $',
      'MXN': 'MX$'
    };

    var countryToCurrency = {
      'US': 'USD',
      'GB': 'GBP',
      'CA': 'CAD',
      'AU': 'AUD',
      'MX': 'MXN',
      'ES': 'EUR',
      'FR': 'EUR',
      'DE': 'EUR',
      'IT': 'EUR',
      'PT': 'EUR'
    };

    // Country Adjustments
    var countryPriceAdjustments = [
      {% for block in section.blocks %}
        {% if block.type == 'country_adjustment' %}
        {
          countryCode: "{{ block.settings.country_code | default: 'US' }}",
          adjustment: {{ block.settings.price_adjustment | default: 0 }}
        }{% unless forloop.last %},{% endunless %}
        {% endif %}
      {% endfor %}
    ];

    var userCountry = '{{ localization.country.iso_code | default: "ES" }}';
    var userCurrency = 'EUR';
    var priceMultiplier = 1.0;

    var countryConfig = null;
    for (var i = 0; i < countryPriceAdjustments.length; i++) {
      if (countryPriceAdjustments[i].countryCode === userCountry) {
        countryConfig = countryPriceAdjustments[i];
        break;
      }
    }

    if (countryConfig) {
      priceMultiplier = 1 + (countryConfig.adjustment / 100);
      userCurrency = countryToCurrency[userCountry] || 'EUR';
    } else {
      userCurrency = countryToCurrency[userCountry] || 'EUR';
    }


    // DOM Elements
    var inputs = {
      customers: document.getElementById('range-customers'),
      orders: document.getElementById('range-orders'),
      products: document.getElementById('range-products')
    };

    var displays = {
      customers: document.getElementById('display-customers'),
      orders: document.getElementById('display-orders'),
      products: document.getElementById('display-products')
    };

    var hidden = {
      customers: document.getElementById('hidden-customers'),
      orders: document.getElementById('hidden-orders'),
      products: document.getElementById('hidden-products'),
      price: document.getElementById('hidden-price'),
      country: document.getElementById('hidden-country'),
      localPrice: document.getElementById('hidden-local-price'),
      isCustom: document.getElementById('hidden-is-custom')
    };

    // Validation
    if (!inputs.customers) {
      return;
    }

    // Guardar paÃ­s en hidden field
    if (hidden.country) hidden.country.value = userCountry;


    function updateDisplays() {
      var vCust = parseInt(inputs.customers.value) || 0;
      var vOrd = parseInt(inputs.orders.value) || 0;
      var vProd = parseInt(inputs.products.value) || 0;

      // Actualizar displays
      displays.customers.innerText = vCust.toLocaleString();
      displays.orders.innerText = vOrd.toLocaleString();
      displays.products.innerText = vProd.toLocaleString();

      // Actualizar hidden fields
      if (hidden.customers) hidden.customers.value = vCust;
      if (hidden.orders) hidden.orders.value = vOrd;
      if (hidden.products) hidden.products.value = vProd;
    }

    // Calculate Price (Called only on form submit)
    function calculatePrice() {
      var vCust = parseInt(inputs.customers.value) || 0;
      var vOrd = parseInt(inputs.orders.value) || 0;
      var vProd = parseInt(inputs.products.value) || 0;

      // Calcular precio base en EUR
      var maxVal = Math.max(vCust, vOrd, vProd);
      var priceFound = null;

      for (var i = 0; i < pricingTiers.length; i++) {
        if (maxVal <= pricingTiers[i].limit) {
          priceFound = pricingTiers[i].price;
          break;
        }
      }

      if (priceFound !== null) {
        // Aplicar ajuste por paÃ­s
        var adjustedPrice = Math.round(priceFound * priceMultiplier);
        
        // Convertir a moneda local
        var conversionRate = conversionRates[userCurrency] || 1;
        var localPrice = Math.round(adjustedPrice * conversionRate);

        // Obtener sÃ­mbolo de moneda
        var currencySymbol = currencySymbols[userCurrency] || userCurrency;

        // Hidden fields
        if (hidden.price) hidden.price.value = adjustedPrice + " EUR (Base: " + priceFound + " EUR)";
        if (hidden.localPrice) hidden.localPrice.value = localPrice + " " + userCurrency;
        if (hidden.isCustom) hidden.isCustom.value = "false";

        return {
          isCustom: false,
          displayPrice: localPrice.toLocaleString() + ' ' + currencySymbol,
          localPrice: localPrice,
          currency: userCurrency
        };
      } else {
        // Custom quote
        if (hidden.price) hidden.price.value = "Custom Quote (Over Limit)";
        if (hidden.localPrice) hidden.localPrice.value = "Custom Quote";
        if (hidden.isCustom) hidden.isCustom.value = "true";

        return {
          isCustom: true,
          displayPrice: null
        };
      }
    }

    // Event Listeners for Sliders (Only update display, not price)
    inputs.customers.addEventListener('input', updateDisplays);
    inputs.orders.addEventListener('input', updateDisplays);
    inputs.products.addEventListener('input', updateDisplays);

    // URL Validation
    var websiteInput = document.getElementById('ContactWebsite');
    var websiteError = document.getElementById('website-error');
    
    if (websiteInput) {
      // Validate website: accepts domains with or without http(s)://
      // Examples: mitienda.com, www.mitienda.com, https://mitienda.com
      var websiteRegex = /^(https?:\/\/)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(\/.*)?$/;
      
      websiteInput.addEventListener('blur', function() {
        var value = this.value.trim();
        if (value && !websiteRegex.test(value)) {
          if (websiteError) websiteError.style.display = 'block';
          this.style.borderColor = '#ff4444';
        } else {
          if (websiteError) websiteError.style.display = 'none';
          this.style.borderColor = '';
        }
      });

      websiteInput.addEventListener('input', function() {
        if (websiteError) websiteError.style.display = 'none';
        this.style.borderColor = '';
      });
    }

    // Form Validation & AJAX Submission
    var formElement = document.querySelector('form[action^="/contact"]');
    var submitButton = document.getElementById('calculator-submit-btn');
    var errorMessage = document.getElementById('calculator-form-error');
    var formContainer = document.querySelector('.form-container');

    if (formElement) {
      formElement.addEventListener('submit', function(e) {
        e.preventDefault(); // Stop native reload

        var formFields = document.querySelectorAll('.form-field input[required], .form-field select[required]');
        var isValid = true;
        
        // Client-side validation
        formFields.forEach(function(field) {
            if (!field.value) {
                isValid = false;
                field.style.borderColor = '#ff4444';
            } else {
                field.style.borderColor = '';
            }
        });


        var websiteRegex = /^(https?:\/\/)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(\/.*)?$/;
        if (websiteInput && websiteInput.value && !websiteRegex.test(websiteInput.value.trim())) {
          isValid = false;
          websiteInput.style.borderColor = '#ff4444';
          if (websiteError) websiteError.style.display = 'block';
        }

        if (!isValid) {
            if (errorMessage) errorMessage.style.display = 'block';
            return; 
        } else {
            if (errorMessage) errorMessage.style.display = 'none';
        }

        var priceData = calculatePrice();
        
        localStorage.setItem('calculatorPriceData', JSON.stringify(priceData));
        localStorage.setItem('calculatorCustomMsg', '{{ section.settings.custom_msg_text | escape }}');

        // Start AJAX submission
        var originalText = "";
        if(submitButton) {
            originalText = submitButton.innerText;
            submitButton.innerText = 'Enviando...';
            submitButton.disabled = true;
        }

        var formData = new FormData(formElement);
        
        fetch(formElement.getAttribute('action'), {
          method: 'POST',
          body: formData
        })
        .then(function(response) {
            // Check for Captcha/Challenge redirect
            if (response.redirected && response.url.includes('challenge')) {
                window.location.href = response.url;
                return;
            }

            // Si el servidor da error (401, 404, 500), lanzamos excepciÃ³n para que el catch haga el envÃ­o nativo
            if (!response.ok) {
                throw new Error("HTTP Status " + response.status);
            }

            return response.text();
        })
        .then(function(html) {
            if(!html) return; 

            // Parse response to see if it was success or error
            var parser = new DOMParser();
            var doc = parser.parseFromString(html, 'text/html');
            
            // Look for success message in response
            var newSuccess = doc.querySelector('.form-success-message');
            var newForm = doc.querySelector('form[action^="/contact"]');

            if (newSuccess) {
                // SUCCESS: Replace form with success message
                formContainer.innerHTML = newSuccess.outerHTML;
                
                // Display price in success message
                var successPriceDisplay = document.getElementById('success-price-display');
                var successMessageText = document.getElementById('success-message-text');
                
                if (successPriceDisplay && priceData) {
                  console.log('Displaying price in success message:', priceData);
                  if (priceData.isCustom) {
                    successPriceDisplay.innerHTML = '<p style="font-size: 1.5rem; font-weight: bold; color: var(--calc-accent-color, #00ff88); margin: 20px 0;">' + localStorage.getItem('calculatorCustomMsg') + '</p>';
                    if (successMessageText) {
                      successMessageText.innerText = '{{ section.settings.success_message_custom | escape }}';
                    }
                  } else {
                    successPriceDisplay.innerHTML = '<div style="margin: 20px 0;"><p style="font-size: 0.9rem; color: #888; text-transform: uppercase; margin-bottom: 10px;">Precio Estimado:</p><p style="font-size: 3rem; font-weight: 800; color: var(--calc-accent-color, #00ff88);">' + priceData.displayPrice + '</p></div>';
                  }
                }
                
                // Clear local storage
                localStorage.removeItem('calculatorPriceData');
                localStorage.removeItem('calculatorCustomMsg');
                
            } else if (newForm) {
                // ERROR (Server side): Replace form with new form (containing errors)
                formContainer.innerHTML = ""; // Clear current
                formContainer.appendChild(newForm);
            } else {
                 if(newSuccess) {
                     formContainer.innerHTML = newSuccess.outerHTML;
                 } else {
                     // Fallback, maybe user was redirected to homepage or similar
                     window.location.reload();
                 }
            }
        })
        .catch(function(err) {
            // FALLBACK: If AJAX fails (e.g. CORS), submit natively
            submitButton.innerText = originalText;
            submitButton.disabled = false;
            formElement.removeEventListener('submit', arguments.callee); 
            formElement.submit(); 
        })
        .finally(function() {
            if(submitButton) {
                submitButton.innerText = originalText;
                submitButton.disabled = false;
            }
        });

      });
      
      // Limpiar error al escribir
      var formFields = document.querySelectorAll('.form-field input, .form-field select');
      formFields.forEach(function(field) {
        field.addEventListener('input', function() {
            if (this.value) {
                this.style.borderColor = '';
            }
        });
      });
    }



    // Initialize displays
    updateDisplays();
    

    var successPriceDisplay = document.getElementById('success-price-display');
    var successMessageText = document.getElementById('success-message-text');
    
    if (successPriceDisplay) {
      var storedPriceData = localStorage.getItem('calculatorPriceData');
      var storedCustomMsg = localStorage.getItem('calculatorCustomMsg');
      
      if (storedPriceData) {
        try {
          var priceData = JSON.parse(storedPriceData);
          
          if (priceData.isCustom) {
            successPriceDisplay.innerHTML = '<p style="font-size: 1.5rem; font-weight: bold; color: var(--calc-accent-color, #00ff88); margin: 20px 0;">' + (storedCustomMsg || '{{ section.settings.custom_msg_text | escape }}') + '</p>';
            if (successMessageText) {
              successMessageText.innerText = '{{ section.settings.success_message_custom | escape }}';
            }
          } else {
            successPriceDisplay.innerHTML = '<div style="margin: 20px 0;"><p style="font-size: 0.9rem; color: #888; text-transform: uppercase; margin-bottom: 10px;">Precio Estimado:</p><p style="font-size: 3rem; font-weight: 800; color: var(--calc-accent-color, #00ff88);">' + priceData.displayPrice + '</p></div>';
          }
          
          localStorage.removeItem('calculatorPriceData');
          localStorage.removeItem('calculatorCustomMsg');
        } catch (e) {}
      }
    }

  })();
</script>




{% schema %}
{
  "name": "Migration Calculator",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "TÃ­tulo Principal",
      "default": "Calcula el coste de tu migraciÃ³n"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "SubtÃ­tulo",
      "default": "Selecciona el volumen de datos para obtener un precio estimado."
    },
    {
      "type": "header",
      "content": "Estilos y Colores"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de Fondo",
      "default": "#0b0b0b"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color de Texto",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Color de Acento (Slider/Valores)",
      "default": "#00ff88"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Color de Fondo del BotÃ³n",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Color de Texto del BotÃ³n",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Color del BotÃ³n al Hover",
      "default": "#00ff88"
    },
    {
      "type": "header",
      "content": "Colores del Formulario"
    },
    {
      "type": "color",
      "id": "form_bg_color",
      "label": "Fondo del Formulario",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "form_border_color",
      "label": "Borde del Formulario",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "input_bg_color",
      "label": "Fondo de Campos",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Borde de Campos",
      "default": "#444444"
    },
    {
      "type": "header",
      "content": "ConfiguraciÃ³n Slider: Clientes"
    },
    {
      "type": "text",
      "id": "label_customers",
      "label": "Label Clientes",
      "default": "Clientes"
    },
    {
      "type": "number",
      "id": "min_customers",
      "label": "MÃ­nimo Clientes",
      "default": 0
    },
    {
      "type": "number",
      "id": "max_customers",
      "label": "MÃ¡ximo Clientes",
      "default": 25000
    },
    {
      "type": "number",
      "id": "step_customers",
      "label": "Step Clientes",
      "default": 100
    },
    {
      "type": "number",
      "id": "default_customers",
      "label": "Valor por Defecto Clientes",
      "default": 500
    },
    {
      "type": "header",
      "content": "ConfiguraciÃ³n Slider: Pedidos"
    },
    {
      "type": "text",
      "id": "label_orders",
      "label": "Label Pedidos",
      "default": "Pedidos"
    },
    {
      "type": "number",
      "id": "min_orders",
      "label": "MÃ­nimo Pedidos",
      "default": 0
    },
    {
      "type": "number",
      "id": "max_orders",
      "label": "MÃ¡ximo Pedidos",
      "default": 25000
    },
    {
      "type": "number",
      "id": "step_orders",
      "label": "Step Pedidos",
      "default": 100
    },
    {
      "type": "number",
      "id": "default_orders",
      "label": "Valor por Defecto Pedidos",
      "default": 2000
    },
    {
      "type": "header",
      "content": "ConfiguraciÃ³n Slider: Productos"
    },
    {
      "type": "text",
      "id": "label_products",
      "label": "Label Productos",
      "default": "Productos"
    },
    {
      "type": "number",
      "id": "min_products",
      "label": "MÃ­nimo Productos",
      "default": 0
    },
    {
      "type": "number",
      "id": "max_products",
      "label": "MÃ¡ximo Productos",
      "default": 25000
    },
    {
      "type": "number",
      "id": "step_products",
      "label": "Step Productos",
      "default": 50
    },
    {
      "type": "number",
      "id": "default_products",
      "label": "Valor por Defecto Productos",
      "default": 100
    },
    {
      "type": "header",
      "content": "Textos del Formulario"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Texto del BotÃ³n",
      "default": "Calcular Presupuesto"
    },
    {
      "type": "textarea",
      "id": "success_message_with_price",
      "label": "Mensaje de Ã‰xito (con precio)",
      "default": "Hemos recibido tus datos correctamente. Te contactaremos en breve con la propuesta detallada."
    },
    {
      "type": "textarea",
      "id": "success_message_custom",
      "label": "Mensaje de Ã‰xito (Custom Quote)",
      "default": "Por el volumen de datos, te contactaremos por email con un presupuesto personalizado a medida."
    },
    {
      "type": "text",
      "id": "custom_msg_text",
      "label": "Mensaje para Custom Quote (en calculadora)",
      "default": "ContÃ¡ctanos para un plan a medida (+20k items)"
    }
  ],
  "blocks": [
    {
      "type": "price_tier",
      "name": "Tramo de Precio",
      "limit": 10,
      "settings": [
        {
          "type": "number",
          "id": "limit",
          "label": "LÃ­mite superior (Hasta X items)",
          "default": 100
        },
        {
          "type": "number",
          "id": "price",
          "label": "Precio (â‚¬)",
          "default": 499
        }
      ]
    },
    {
      "type": "country_adjustment",
      "name": "Ajuste por PaÃ­s",
      "limit": 20,
      "settings": [
        {
          "type": "text",
          "id": "country_code",
          "label": "CÃ³digo ISO del PaÃ­s (ej: US, GB, MX)",
          "default": "US",
          "info": "CÃ³digo de 2 letras del paÃ­s"
        },
        {
          "type": "number",
          "id": "price_adjustment",
          "label": "Ajuste de Precio (%)",
          "default": 20,
          "info": "Porcentaje de incremento. Ej: 20 = +20%"
        }
      ]
    },
    {
      "type": "phone_country",
      "name": "PaÃ­s de TelÃ©fono",
      "limit": 50,
      "settings": [
        {
          "type": "text",
          "id": "flag_emoji",
          "label": "Bandera (Emoji)",
          "default": "ðŸ‡ªðŸ‡¸",
          "info": "Emoji de la bandera del paÃ­s (ej: ðŸ‡ªðŸ‡¸, ðŸ‡ºðŸ‡¸, ðŸ‡¬ðŸ‡§)"
        },
        {
          "type": "text",
          "id": "phone_code",
          "label": "CÃ³digo TelefÃ³nico",
          "default": "+34",
          "info": "CÃ³digo de telÃ©fono con + (ej: +34, +1, +44)"
        },
        {
          "type": "text",
          "id": "country_name",
          "label": "Nombre del PaÃ­s",
          "default": "EspaÃ±a",
          "info": "Nombre del paÃ­s para referencia"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Migration Cost Calculator",
      "blocks": [
        {"type": "price_tier", "settings": {"limit": 100, "price": 499}},
        {"type": "price_tier", "settings": {"limit": 500, "price": 799}},
        {"type": "price_tier", "settings": {"limit": 1000, "price": 999}},
        {"type": "price_tier", "settings": {"limit": 2000, "price": 1250}},
        {"type": "price_tier", "settings": {"limit": 5000, "price": 1999}},
        {"type": "price_tier", "settings": {"limit": 10000, "price": 2499}},
        {"type": "price_tier", "settings": {"limit": 20000, "price": 3999}},
        {"type": "country_adjustment", "settings": {"country_code": "US", "price_adjustment": 20}},
        {"type": "country_adjustment", "settings": {"country_code": "GB", "price_adjustment": 15}},
        {"type": "country_adjustment", "settings": {"country_code": "AU", "price_adjustment": 25}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡ªðŸ‡¸", "phone_code": "+34", "country_name": "EspaÃ±a"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡ºðŸ‡¸", "phone_code": "+1", "country_name": "Estados Unidos"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡¬ðŸ‡§", "phone_code": "+44", "country_name": "Reino Unido"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡«ðŸ‡·", "phone_code": "+33", "country_name": "Francia"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡©ðŸ‡ª", "phone_code": "+49", "country_name": "Alemania"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡®ðŸ‡¹", "phone_code": "+39", "country_name": "Italia"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡µðŸ‡¹", "phone_code": "+351", "country_name": "Portugal"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡²ðŸ‡½", "phone_code": "+52", "country_name": "MÃ©xico"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡¨ðŸ‡¦", "phone_code": "+1", "country_name": "CanadÃ¡"}},
        {"type": "phone_country", "settings": {"flag_emoji": "ðŸ‡¦ðŸ‡º", "phone_code": "+61", "country_name": "Australia"}}
      ]
    }
  ]
}
{% endschema %}